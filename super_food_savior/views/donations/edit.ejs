<%- include('../partials/header') %>
<form>
<input type="text" id="radius" name="radius" />
<input type="submit" />
</form>
<div id="map"></div>
<script>
let array = [];
console.log('<%= users[1].address %>')

function initMap() {

  let map = new google.maps.Map(document.getElementById('map'), {
    zoom: 14,
  });
  let radius = parseInt(document.getElementById('radius').value, 10) * 1000;
  if(navigator.geolocation) {
    let circle = new google.maps.Circle({
          radius: radius ? radius : 0,
          map: map
        });

    navigator.geolocation.getCurrentPosition(function(position) {
      let pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      accuracy = parseFloat(position.coords.accuracy);
      map.setZoom(14);
      circle.setCenter(pos);
      circle.setRadius(accuracy);
      map.fitBounds(circle.getBounds());
      let infowindow = new google.maps.InfoWindow({
          map: map,
          position: pos,
          content: 'This is your current position'
      });
    }, function() {
      circle.setMap(null);
    });
  }

  let geocoder = new google.maps.Geocoder();
  addressCode(geocoder, map);

}

function addressCode(geocoder, map) {
  geocoder.geocode({ 'address' : "<%= current_user.address %>" }, function(results, status) {
    if (status === 'OK') {
      map.setCenter(results[0].geometry.location);
      let marker = new google.maps.Marker({
        map: map,
        position: results[0].geometry.location
      });

      let infoWindow = new google.maps.InfoWindow({
        content: '<%= current_user.address %>'
      });

      marker.addListener('click', function () {
        infoWindow.open(map, marker);
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  })
}

</script>
<script
  async defer src="https://maps.googleapis.com/maps/api/js?key=<%=GMAP_KEY%>&callback=initMap"
  type="text/javascript"
>
</script>

<%- include('../partials/footer') %>
